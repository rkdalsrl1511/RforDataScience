7장 : tibble로 하는 티블
================
huimin
2019년 4월 29일

기초 설정하기
=============

``` r
library(tidyverse)
```

    ## Registered S3 methods overwritten by 'ggplot2':
    ##   method         from 
    ##   [.quosures     rlang
    ##   c.quosures     rlang
    ##   print.quosures rlang

    ## Registered S3 method overwritten by 'rvest':
    ##   method            from
    ##   read_xml.response xml2

    ## -- Attaching packages --------------------- tidyverse 1.2.1 --

    ## √ ggplot2 3.1.1       √ purrr   0.3.2  
    ## √ tibble  2.1.1       √ dplyr   0.8.0.1
    ## √ tidyr   0.8.3       √ stringr 1.4.0  
    ## √ readr   1.3.1       √ forcats 0.4.0

    ## -- Conflicts ------------------------ tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

들어가기
========

**티블도 데이터프레임**이지만, 좀 더 편리하게 사용할 수 있도록 오래된 동작들이 수정되었다. 기존의 코드를 손상시키지 않기 위해서 패키지의 형태로 업데이트 되었다.

tidyverse패키지에 포함되어 있는 tibble패키지를 통해서 생성한다.

티블 생성하기
=============

|          함수         |                        설명                       |
|:---------------------:|:-------------------------------------------------:|
| as\_tibble(dataframe) |             데이터프레임을 티블로 전환            |
|        tibble()       |                   티블 생성하기                   |
|       tribble()       | 적은 양의 데이터를 읽기 쉬운 형태로 배치하는 티블 |

``` r
# 기존 데이터프레임을 티블로 전환하기
as_tibble(iris)
```

    ## # A tibble: 150 x 5
    ##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
    ##           <dbl>       <dbl>        <dbl>       <dbl> <fct>  
    ##  1          5.1         3.5          1.4         0.2 setosa 
    ##  2          4.9         3            1.4         0.2 setosa 
    ##  3          4.7         3.2          1.3         0.2 setosa 
    ##  4          4.6         3.1          1.5         0.2 setosa 
    ##  5          5           3.6          1.4         0.2 setosa 
    ##  6          5.4         3.9          1.7         0.4 setosa 
    ##  7          4.6         3.4          1.4         0.3 setosa 
    ##  8          5           3.4          1.5         0.2 setosa 
    ##  9          4.4         2.9          1.4         0.2 setosa 
    ## 10          4.9         3.1          1.5         0.1 setosa 
    ## # ... with 140 more rows

``` r
# 티블은 아래처럼, 방금 만든 변수를 참조할 수도 있다.
tibble(x = 1:5, y = 1, z = x^2+y)
```

    ## # A tibble: 5 x 3
    ##       x     y     z
    ##   <int> <dbl> <dbl>
    ## 1     1     1     2
    ## 2     2     1     5
    ## 3     3     1    10
    ## 4     4     1    17
    ## 5     5     1    26

``` r
# 티블은 유효하지 않은 이름(비구문론적 이름)을 열 이름으로 가질 수 있다.
# 단, 역따옴표로 감싸야한다.
tb <- tibble(`:)` = "스마일",
             ` ` = "공백",
             `2000` = "숫자")

tb
```

    ## # A tibble: 1 x 3
    ##   `:)`   ` `   `2000`
    ##   <chr>  <chr> <chr> 
    ## 1 스마일 공백  숫자

``` r
# tribble을 통해서 티블 생성하기
tribble(~x, ~y, ~z,
        "a", 2, 3.6,
        "b", 1, 8.5)
```

    ## # A tibble: 2 x 3
    ##   x         y     z
    ##   <chr> <dbl> <dbl>
    ## 1 a         2   3.6
    ## 2 b         1   8.5

티블 vs 데이터프레임
====================

**화면 출력**과 **서브셋하기**에서 차이가 있다.<br> 인덱싱과 슬라이싱 등은 모두 데이터프레임과 사용법이 동일하다.

화면 출력
---------

티블에서는 대용량 데이터 작업을 쉽게 할 수 있는 방법이 존재한다.<br> option()을 설정하여 기본 출력 동작을 제어할 수 있다.

|                         함수                         |               설명               |
|:----------------------------------------------------:|:--------------------------------:|
| option(tibble.print\_max = n, tibble.print\_min = m) | m행 이상인 경우, n행만 출력한다. |
|            option(dplyr.print\_min = Inf)            |        모든 행을 항상 표시       |
|              option(tibble.width = Inf)              |          모든 열을 출력          |

``` r
tibble(a = lubridate::now() + runif(1e3)*86400,
       b = lubridate::today() + runif(1e3)*30,
       c = 1:1e3,
       d = runif(1e3),
       e = sample(letters, 1e3, replace = TRUE))
```

    ## # A tibble: 1,000 x 5
    ##    a                   b              c      d e    
    ##    <dttm>              <date>     <int>  <dbl> <chr>
    ##  1 2019-05-01 14:35:14 2019-05-05     1 0.472  a    
    ##  2 2019-05-01 10:45:36 2019-05-17     2 0.729  f    
    ##  3 2019-05-01 00:06:03 2019-05-12     3 0.490  b    
    ##  4 2019-05-01 04:47:25 2019-05-26     4 0.0754 w    
    ##  5 2019-05-01 01:06:37 2019-05-19     5 0.104  v    
    ##  6 2019-05-01 03:38:33 2019-05-05     6 0.577  y    
    ##  7 2019-05-01 08:39:27 2019-05-12     7 0.667  n    
    ##  8 2019-05-01 09:50:15 2019-05-03     8 0.557  v    
    ##  9 2019-05-01 20:27:54 2019-05-19     9 0.555  n    
    ## 10 2019-05-01 15:16:01 2019-05-28    10 0.182  k    
    ## # ... with 990 more rows

``` r
# 데이터프레임에서는 print를 통해서 width = Inf를 하면 모든 열을 표시
diamonds %>%
  print(n=10, width = Inf)
```

    ## # A tibble: 53,940 x 10
    ##    carat cut       color clarity depth table price     x     y     z
    ##    <dbl> <ord>     <ord> <ord>   <dbl> <dbl> <int> <dbl> <dbl> <dbl>
    ##  1 0.23  Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
    ##  2 0.21  Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
    ##  3 0.23  Good      E     VS1      56.9    65   327  4.05  4.07  2.31
    ##  4 0.290 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
    ##  5 0.31  Good      J     SI2      63.3    58   335  4.34  4.35  2.75
    ##  6 0.24  Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48
    ##  7 0.24  Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47
    ##  8 0.26  Very Good H     SI1      61.9    55   337  4.07  4.11  2.53
    ##  9 0.22  Fair      E     VS2      65.1    61   337  3.87  3.78  2.49
    ## 10 0.23  Very Good H     VS1      59.4    61   338  4     4.05  2.39
    ## # ... with 5.393e+04 more rows

서브셋하기
----------

데이터프레임에서 변수 하나를 추출하려면 새로운 도구인 $및 \[\[이 필요하다. \[\[는 이름이나 위치로 추출할 수 있다.<br> $는 이름으로만 추출할 수 있지만 타이핑을 덜 해도 된다.

``` r
df <- tibble(x = runif(5),
             y = rnorm(5))

# 이름으로 추출
df$x
```

    ## [1] 0.3323855 0.1724416 0.1862668 0.3828701 0.7244129

``` r
# 티블은 2중 대괄호를 넣지 않으면, 티블로 반환한다. 리스트처럼
df[["x"]]
```

    ## [1] 0.3323855 0.1724416 0.1862668 0.3828701 0.7244129

``` r
# 위치로 추출
df[[1]]
```

    ## [1] 0.3323855 0.1724416 0.1862668 0.3828701 0.7244129

``` r
# 파이프를 사용하여 추출
df %>% .$x
```

    ## [1] 0.3323855 0.1724416 0.1862668 0.3828701 0.7244129

``` r
df %>% .[["x"]]
```

    ## [1] 0.3323855 0.1724416 0.1862668 0.3828701 0.7244129

이전코드와 상호작용
-------------------

오래된 함수는 티블에서 작동하지 않는다. 이러한 함수를 사용하려면 **as.data.frame()**을 사용하여 티블을 data.frame으로 되돌려야 한다.<br>

연습문제
--------

``` r
# 데이터프레임과 티블 비교하기
mtcars
```

    ##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
    ## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
    ## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
    ## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
    ## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
    ## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
    ## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
    ## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
    ## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
    ## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
    ## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
    ## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
    ## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
    ## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
    ## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
    ## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
    ## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
    ## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
    ## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
    ## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
    ## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
    ## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
    ## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
    ## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
    ## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
    ## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
    ## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
    ## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
    ## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
    ## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
    ## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
    ## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
    ## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2

``` r
as.tibble(mtcars)
```

    ## Warning: `as.tibble()` is deprecated, use `as_tibble()` (but mind the new semantics).
    ## This warning is displayed once per session.

    ## # A tibble: 32 x 11
    ##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
    ##    <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
    ##  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
    ##  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
    ##  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
    ##  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
    ##  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
    ##  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
    ##  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
    ##  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
    ##  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
    ## 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
    ## # ... with 22 more rows

``` r
tb <- tibble(abc = 1,
             xyz = "a")

tb$x
```

    ## Warning: Unknown or uninitialised column: 'x'.

    ## NULL

``` r
tb[["xyz"]]
```

    ## [1] "a"

``` r
tb[c("abc","xyz")]
```

    ## # A tibble: 1 x 2
    ##     abc xyz  
    ##   <dbl> <chr>
    ## 1     1 a

``` r
# 비구문론적 이름 참조하기
tb <- tibble(`1` = 1:3,
             `2` = 4:6,
             `4` = `1` / `2`)

# 열의 이름을 바꾸기
colnames(tb) <- c("one","two","three")


# tibble::enframe의 의미
# 두 개의 원자벡터 혹은 리스트를 하나 또는 두 개의 열 데이터프레임으로 변환한다. 
tibble::enframe(c(a=5,b=7))
```

    ## # A tibble: 2 x 2
    ##   name  value
    ##   <chr> <dbl>
    ## 1 a         5
    ## 2 b         7
